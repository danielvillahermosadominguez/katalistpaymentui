
<!DOCTYPE html>
<html>
<head>
<title>Katalist course subscription</title>
</head>
<body>
<h1>Katalist course subscription</h1>
<p>Please fill the data and submit to subscribe to the course</p>


<form id="form_submit" method="post" ">
  <label for="email">Course ID:</label>
  <input type="text" id="courseId" name="courseId" value="" ><br><br>
  <label for="email" >Email:</label>
  <input type="email" id="email" name="email" value="" ><br><br>
  <label for="email">Name:</label>
  <input type="text" id="name" name="name" value="" ><br><br>
  <label for="email">Surname:</label>
  <input type="text" id="surname" name="surname" value="" ><br><br>
  <label for="email">Company Name:</label>
  <input type="text" id="company" name="company" value="" ><br><br>
  <label for="dnicif">DNI/CIF:</label>
  <input type="text" id="dnicif" name="dnicif" value="" ><br><br>
  <label for="dnicif">Payment method:</label>
  <select id="paymentMethod" name="paymentMethod" >
	<option value="Free">No payment</option>
	<option value="Paycomet">Payment</option>	
  </select>  <br><br>
  <input type="Button" value = "Submit" onclick="submitForm()">
 <!-- <a href="#" onclick="submitForm()">Submit Here</a>-->
</form>

</body>
<script>
		
	function validateForm() {
	    let email = document.forms["form_submit"]["email"].value;
		if (email == "") {
			alert("The email is mandatory");
			return false;
		}
    }
	async function submitForm() {
		let url = "";
		let selector = document.getElementById("paymentMethod")		
		let payment_method = selector.value		
		if(payment_method === 'Free') {
			url = "https://katalistpaymentservice.azurewebsites.net:8080/freesubscription"
			//url = "http://localhost:8080/freesubscription"
		} else if(payment_method = 'Paycomet') {
			url = ""
		}			
						
		let formData = new FormData(document.getElementById('form_submit'))
		let json = JSON.stringify(Object.fromEntries(formData))				
		try {
			const response = await fetch(url, {
					headers: {
						'Accept': 'application/json',
						'Content-Type': 'application/json'
					},
					method: "POST",
					body: json
			})
			
			if(!response.ok) {												
				let status = await response.status				
				if (status === 422) {
					alert("This user is subscribed to the course yet. Please review you mail inbox to access to the course")
				} else if (status === 400) {
					alert("The selected course doesn't exist. Please check this field")
				} else {
					alert("It has been an error.")
				}
			} else {
				if(payment_method === 'Free') {
					alert("Please, review your inbox. You should receive an email with the suscription")
				} else {
					alert("Please, review your inbox. You should receive an email to start the payment previous the suscription")
				}				
			}
		} catch(error) {
			alert("There is not connection to the server. Please try again.")
		}
	}
	
</script>

</html>
